<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DevBlogs - AI-Powered Platform</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Compiler (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Axios (for API calls) -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- Markdown Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple scrollbar styling for the new theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111827; /* Darker gray */
        }
        ::-webkit-scrollbar-thumb {
            background: #374151; /* Medium gray */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563; /* Lighter gray on hover */
        }
        .prose h1, .prose h2, .prose h3, .prose a, .prose strong { color: white; }
        .prose p, .prose li, .prose code { color: #d1d5db; } /* Lighter gray for text */
        .prose pre { background-color: #000000; padding: 1rem; border-radius: 0.5rem; } /* Black code blocks */
        .loader {
            border: 4px solid #4b5563; /* Gray loader */
            border-top: 4px solid #10b981; /* Green spinner */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Toast Notification Animations */
        @keyframes toast-in {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes toast-out {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(100%); opacity: 0; }
        }
        .toast-enter {
            animation: toast-in 0.3s forwards;
        }
        .toast-exit {
            animation: toast-out 0.3s forwards;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // --- Toast Notification Context ---
        const ToastContext = createContext();

        function ToastProvider({ children }) {
            const [toast, setToast] = useState(null);

            const showToast = (message, type = 'success') => {
                setToast({ message, type });
                setTimeout(() => {
                    setToast(null);
                }, 3000);
            };

            return (
                <ToastContext.Provider value={showToast}>
                    {children}
                    {toast && <Toast message={toast.message} type={toast.type} onDismiss={() => setToast(null)} />}
                </ToastContext.Provider>
            );
        }

        const useToast = () => useContext(ToastContext);

        function Toast({ message, type, onDismiss }) {
             const [isExiting, setIsExiting] = useState(false);

            useEffect(() => {
                const timer = setTimeout(() => {
                    setIsExiting(true);
                    setTimeout(onDismiss, 300); // Wait for animation to finish
                }, 2700);
                return () => clearTimeout(timer);
            }, [onDismiss]);
            
            const bgColor = type === 'success' ? 'bg-emerald-500' : 'bg-red-500';

            return (
                <div 
                    className={`fixed bottom-5 right-5 p-4 rounded-lg shadow-lg text-white ${bgColor} ${isExiting ? 'toast-exit' : 'toast-enter'}`}
                >
                    {message}
                </div>
            );
        }

        // --- API Configuration ---
        const API_URL = ' https://devblogs-backend-ayush.onrender.com';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=';
        const GEMINI_API_KEY = ""; // Intentionally empty

        // --- Gemini API Caller ---
        const callGeminiAPI = async (prompt) => {
             const payload = {
                contents: [{ parts: [{ text: prompt }] }],
            };
            const response = await fetch(GEMINI_API_URL + GEMINI_API_KEY, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error('Gemini API request failed');
            }
            const result = await response.json();
            return result.candidates[0].content.parts[0].text;
        }

        // --- Main App Component ---
        function App() {
            const [page, setPage] = useState('home');
            const [user, setUser] = useState(null);
            const [token, setToken] = useState(localStorage.getItem('token'));
            const [selectedBlog, setSelectedBlog] = useState(null);
           
            useEffect(() => {
                const storedUser = localStorage.getItem('user');
                if (storedUser && token) {
                    setUser(JSON.parse(storedUser));
                }
            }, [token]);

            const showToast = useToast();

            const navigate = (pageName, blog = null) => {
                setSelectedBlog(blog);
                setPage(pageName);
                window.scrollTo(0, 0);
            };
            
            const handleAuthSuccess = (data, message) => {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                setToken(data.token);
                setUser(data.user);
                navigate('home');
                showToast(message, 'success');
            };

            const handleLogout = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                setToken(null);
                setUser(null);
                navigate('home');
                showToast('Logged out successfully.', 'success');
            };
            
            const handleGeneratedPost = (post) => {
                navigate('create', post); // Navigate to create page with pre-filled content
            }

            const renderPage = () => {
                if (selectedBlog && page === 'blogDetail') {
                    return <BlogDetailPage blogId={selectedBlog._id} onBack={() => navigate('home')} />;
                }
                switch (page) {
                    case 'login':
                        return <LoginPage onAuthSuccess={handleAuthSuccess} setPage={navigate} />;
                    case 'signup':
                        return <SignupPage onAuthSuccess={handleAuthSuccess} setPage={navigate} />;
                    case 'create':
                        return <CreatePostPage token={token} setPage={navigate} initialPost={selectedBlog} />;
                    case 'generate':
                        return <GeneratePostPage onPostGenerated={handleGeneratedPost} />;
                    case 'admin':
                        return <AdminDashboard token={token} />;
                    default:
                        return <HomePage onBlogSelect={(blog) => navigate('blogDetail', blog)} />;
                }
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-200">
                    <NavBar user={user} setPage={navigate} onLogout={handleLogout} />
                    <main className="container mx-auto px-4 py-8">
                        {renderPage()}
                    </main>
                </div>
            );
        }

        // --- Components ---
        function NavBar({ user, setPage, onLogout }) {
            return (
                <nav className="bg-gray-800 shadow-lg sticky top-0 z-50">
                    <div className="container mx-auto px-4">
                        <div className="flex justify-between items-center py-4">
                            <div className="text-2xl font-bold text-white cursor-pointer" onClick={() => setPage('home')}>
                                DevBlogs<span className="text-emerald-400">.</span>ai
                            </div>
                            <div className="flex items-center space-x-6">
                                <a href="#" className="text-gray-300 hover:text-emerald-400 transition-colors" onClick={() => setPage('home')}>Home</a>
                                {user ? (
                                    <>
                                        {user.role === 'admin' && (
                                            <a href="#" className="text-gray-300 hover:text-emerald-400 transition-colors" onClick={() => setPage('admin')}>Admin Panel</a>
                                        )}
                                        <a href="#" className="text-gray-300 hover:text-emerald-400 transition-colors" onClick={() => setPage('generate')}>Write with AI ✨</a>
                                        <a href="#" className="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded transition-colors" onClick={() => setPage('create')}>
                                            Create Post
                                        </a>
                                        <button onClick={onLogout} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors">
                                            Logout
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <a href="#" className="text-gray-300 hover:text-emerald-400 font-bold transition-colors" onClick={() => setPage('login')}>
                                            Login
                                        </a>
                                         <a href="#" className="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded transition-colors" onClick={() => setPage('signup')}>
                                            Sign Up
                                        </a>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                </nav>
            );
        }
        
        function SkeletonCard() { /* ... Same as before ... */ 
            return (
                <div className="bg-gray-800 rounded-lg shadow-md overflow-hidden border border-gray-700">
                    <div className="w-full h-48 bg-gray-700 animate-pulse"></div>
                    <div className="p-6">
                        <div className="h-6 w-3/4 bg-gray-700 rounded mb-4 animate-pulse"></div>
                        <div className="h-4 w-1/2 bg-gray-700 rounded mb-6 animate-pulse"></div>
                        <div className="h-4 w-full bg-gray-700 rounded animate-pulse mb-2"></div>
                        <div className="h-4 w-5/6 bg-gray-700 rounded animate-pulse"></div>
                    </div>
                </div>
             );
        }

        function HomePage({ onBlogSelect }) {
            const [blogs, setBlogs] = useState([]);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const fetchBlogs = async () => {
                    setIsLoading(true);
                    try {
                        const response = await axios.get(`${API_URL}/blogs`);
                        setBlogs(response.data.data.reverse());
                    } catch (error) {
                        console.error('Error fetching blogs:', error);
                    } finally {
                        setTimeout(() => setIsLoading(false), 500); // Simulate loading
                    }
                };
                fetchBlogs();
            }, []);

            return (
                <div>
                    <div className="relative bg-gray-800 rounded-lg shadow-lg overflow-hidden mb-12">
                        {/* ... Hero section is the same ... */}
                        <img src="https://images.unsplash.com/photo-1542831371-29b0f74f9713?q=80&w=2070&auto=format&fit=crop" 
                             alt="Abstract code background" 
                             className="w-full h-80 object-cover opacity-30"
                             onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/1200x400/111827/4b5563?text=Code+Abstract'; }}
                        />
                        <div className="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
                            <h1 className="text-5xl font-extrabold mb-4 text-white">Share Your Knowledge. Shape the Future.</h1>
                            <p className="text-xl text-emerald-300 max-w-2xl">The AI-powered blogging platform for the next generation of developers.</p>
                        </div>
                    </div>

                    <h2 className="text-4xl font-bold mb-8 text-center">Latest Posts</h2>
                    {isLoading ? (
                         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {[...Array(3)].map((_, i) => <SkeletonCard key={i} />)}
                        </div>
                    ) : blogs.length > 0 ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {blogs.map(blog => <BlogCard key={blog._id} blog={blog} onBlogSelect={onBlogSelect} />)}
                        </div>
                    ) : (
                         <p className="text-center text-gray-400 mt-16">No approved posts yet. Check back soon!</p>
                    )}
                </div>
            );
        }

        function BlogCard({ blog, onBlogSelect }) {
            const sanitizedContent = () => ({ __html: DOMPurify.sanitize(marked.parse(blog.content.substring(0, 150) + '...')) });
            const imageUrl = `https://placehold.co/600x400/111827/10b981?text=${encodeURIComponent(blog.title)}`;

            return (
                <div onClick={() => onBlogSelect(blog)} className="cursor-pointer bg-gray-800 rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 transition-transform duration-300 border border-gray-700 hover:border-emerald-500">
                    <img src={imageUrl} alt={`Blog post titled ${blog.title}`} className="w-full h-48 object-cover" />
                    <div className="p-6">
                        <h2 className="text-2xl font-bold mb-2 text-white">{blog.title}</h2>
                        <p className="text-gray-400 mb-4">by {blog.author.name}</p>
                        <div className="text-gray-300 prose" dangerouslySetInnerHTML={sanitizedContent()} />
                    </div>
                </div>
            );
        }

        function BlogDetailPage({ blogId, onBack }) {
            const [blog, setBlog] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const fetchBlog = async () => {
                    setIsLoading(true);
                    try {
                        const response = await axios.get(`${API_URL}/blogs/${blogId}`);
                        setBlog(response.data.data);
                    } catch (error) {
                        console.error("Error fetching blog details:", error);
                    } finally {
                        setIsLoading(false);
                    }
                };
                fetchBlog();
            }, [blogId]);

            if (isLoading) {
                return (
                    <div className="max-w-4xl mx-auto">
                        <div className="h-10 w-3/4 bg-gray-700 rounded animate-pulse mb-4"></div>
                        <div className="h-6 w-1/2 bg-gray-700 rounded animate-pulse mb-8"></div>
                        <div className="space-y-4">
                            {[...Array(5)].map((_, i) => <div key={i} className="h-4 bg-gray-700 rounded animate-pulse"></div>)}
                        </div>
                    </div>
                );
            }

            if (!blog) return <p>Blog post not found.</p>;

            const sanitizedContent = () => ({ __html: DOMPurify.sanitize(marked.parse(blog.content)) });

            return (
                <div className="max-w-4xl mx-auto">
                    <button onClick={onBack} className="mb-8 text-emerald-400 hover:text-emerald-300">&larr; Back to all posts</button>
                    <h1 className="text-5xl font-extrabold mb-4 text-white">{blog.title}</h1>
                    <p className="text-gray-400 mb-8 text-lg">By {blog.author.name} on {new Date(blog.createdAt).toLocaleDateString()}</p>
                    <div className="prose prose-lg max-w-none" dangerouslySetInnerHTML={sanitizedContent()} />
                </div>
            );
        }
        
        function AuthLayout({ children }) { /* ... Same as before ... */ 
             const authImageUrl = "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=1887&auto=format&fit=crop";
            return (
                <div className="min-h-[70vh] flex items-center justify-center">
                    <div className="w-full max-w-4xl bg-gray-800 rounded-lg shadow-lg overflow-hidden md:grid md:grid-cols-2 border border-gray-700">
                        <div 
                            className="hidden md:flex flex-col items-center justify-center p-12 text-white relative"
                            style={{ backgroundImage: `url(${authImageUrl})`, backgroundSize: 'cover', backgroundPosition: 'center' }}
                            onError={(e) => { e.target.style.backgroundColor = '#10b981'; e.target.style.backgroundImage = 'none'; }}
                        >
                            <div className="absolute inset-0 bg-black opacity-60"></div>
                             <div className="relative z-10 text-center">
                                <h2 className="text-3xl font-bold mb-4">DevBlogs<span className="text-emerald-400">.</span>ai</h2>
                                <p className="text-emerald-200">The premier platform for developers to share their knowledge, powered by AI.</p>
                             </div>
                        </div>
                        <div className="p-8 md:p-12">
                            {children}
                        </div>
                    </div>
                </div>
            );
        }
        function LoginPage({ onAuthSuccess, setPage }) { /* ... Same as before ... */ 
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const showToast = useToast();

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const response = await axios.post(`${API_URL}/auth/login`, { email, password });
                    if (response.data.success) {
                        onAuthSuccess(response.data, 'Login Successful!');
                    }
                } catch (err) {
                    showToast('Invalid credentials. Please try again.', 'error');
                    console.error('Login failed:', err);
                }
            };
            
            return (
                <AuthLayout>
                    <h2 className="text-3xl font-bold text-center mb-6">Login</h2>
                    <form onSubmit={handleSubmit}>
                        <div className="mb-4">
                            <label className="block text-gray-300 mb-2" htmlFor="login-email">Email Address</label>
                            <input
                                type="email" id="login-email" value={email} onChange={(e) => setEmail(e.target.value)}
                                className="w-full px-3 py-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                required
                            />
                        </div>
                        <div className="mb-6">
                            <label className="block text-gray-300 mb-2" htmlFor="login-password">Password</label>
                            <input
                                type="password" id="login-password" value={password} onChange={(e) => setPassword(e.target.value)}
                                className="w-full px-3 py-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                required
                            />
                        </div>
                        <button type="submit" className="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded transition-colors">
                            Login
                        </button>
                    </form>
                    <div className="text-center mt-4">
                        <button onClick={() => setPage('signup')} className="text-emerald-400 hover:text-emerald-300">
                            Don't have an account? Sign Up
                        </button>
                    </div>
                </AuthLayout>
            );
        }
        function SignupPage({ onAuthSuccess, setPage }) { /* ... Same as before ... */ 
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const showToast = useToast();

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const response = await axios.post(`${API_URL}/auth/register`, { name, email, password });
                    if (response.data.success) {
                        onAuthSuccess(response.data, 'Account created successfully!');
                    }
                } catch (err) {
                    const errorMsg = err.response?.data?.msg || `An error occurred. Please try again.`;
                    const displayError = errorMsg.includes('duplicate key') ? 'An account with this email already exists.' : errorMsg;
                    showToast(displayError, 'error');
                    console.error('Auth failed:', err);
                }
            };

            return (
                <AuthLayout>
                    <h2 className="text-3xl font-bold text-center mb-6">Create an Account</h2>
                    <form onSubmit={handleSubmit}>
                        <div className="mb-4">
                            <label className="block text-gray-300 mb-2" htmlFor="signup-name">Full Name</label>
                            <input
                                type="text" id="signup-name" value={name} onChange={(e) => setName(e.target.value)}
                                className="w-full px-3 py-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                required
                            />
                        </div>
                        <div className="mb-4">
                            <label className="block text-gray-300 mb-2" htmlFor="signup-email">Email Address</label>
                            <input
                                type="email" id="signup-email" value={email} onChange={(e) => setEmail(e.target.value)}
                                className="w-full px-3 py-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                required
                            />
                        </div>
                        <div className="mb-6">
                            <label className="block text-gray-300 mb-2" htmlFor="signup-password">Password</label>
                            <input
                                type="password" id="signup-password" value={password} onChange={(e) => setPassword(e.target.value)}
                                className="w-full px-3 py-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                required
                            />
                        </div>
                        <button type="submit" className="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded transition-colors">
                            Create Account
                        </button>
                    </form>
                    <div className="text-center mt-4">
                        <button onClick={() => setPage('login')} className="text-emerald-400 hover:text-emerald-300">
                            Already have an account? Login
                        </button>
                    </div>
                </AuthLayout>
            );
        }
        
        function GeneratePostPage({ onPostGenerated }) {
            const [topic, setTopic] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const showToast = useToast();

            const handleGeneration = async (e) => {
                e.preventDefault();
                if(!topic) {
                    showToast("Please enter a topic for the blog post.", 'error');
                    return;
                }
                setIsGenerating(true);
                try {
                    const prompt = `Generate a full blog post about "${topic}". The post should have a title and content. The content should be well-structured markdown, including headings, paragraphs, and a code block example. Return the result as a single JSON object with two keys: "title" and "content". For example: {"title": "Your Generated Title", "content": "# Introduction\\n\\nThis is the generated content..."}`;
                    const response = await callGeminiAPI(prompt);
                    const generatedPost = JSON.parse(response);
                    onPostGenerated(generatedPost);
                } catch(err) {
                    showToast('Failed to generate post. The AI may be busy, please try again.', 'error');
                    console.error("Failed to generate post with AI", err);
                } finally {
                    setIsGenerating(false);
                }
            };
            
            return (
                 <div className="max-w-2xl mx-auto text-center">
                    <h1 className="text-4xl font-bold mb-4">Write with AI ✨</h1>
                    <p className="text-gray-400 mb-8">Simply enter a topic, and our AI will generate a complete, high-quality blog post draft for you in seconds.</p>
                    <form onSubmit={handleGeneration} className="flex items-center gap-2">
                        <input
                            type="text"
                            value={topic}
                            onChange={(e) => setTopic(e.target.value)}
                            placeholder="e.g., 'An introduction to React Hooks'"
                            className="flex-grow px-4 py-3 bg-gray-800 rounded border border-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                        />
                         <button type="submit" disabled={isGenerating} className="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-5 rounded flex items-center disabled:opacity-50 transition-colors">
                            {isGenerating ? <div className="loader"></div> : "Generate Post"}
                        </button>
                    </form>
                </div>
            );
        }

        function CreatePostPage({ token, setPage, initialPost = null }) {
            const [title, setTitle] = useState(initialPost?.title || '');
            const [content, setContent] = useState(initialPost?.content || '');
            // ... The rest of the CreatePostPage component is the same as before
            const showToast = useToast();
            const [isGenerating, setIsGenerating] = useState(false);
            const [titleSuggestions, setTitleSuggestions] = useState([]);

            const handleGenerateTitles = async () => {
                if (!content) {
                    showToast("Please write some content first to generate titles.", 'error');
                    return;
                }
                setIsGenerating(true);
                setTitleSuggestions([]);
                try {
                    const prompt = `Based on the following blog post content, generate 5 creative and engaging titles. Return them as a JavaScript array of strings, like this: ["Title 1", "Title 2", "Title 3", "Title 4", "Title 5"].\n\nContent:\n${content}`;
                    const response = await callGeminiAPI(prompt);
                    const suggestions = JSON.parse(response.replace(/'/g, '"'));
                    setTitleSuggestions(suggestions);
                } catch (err) {
                    showToast("Could not generate titles. Please try again.", 'error');
                    console.error(err);
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    await axios.post(`${API_URL}/blogs`, { title, content }, {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    showToast('Blog post submitted for review!', 'success');
                    setTitle('');
                    setContent('');
                    setTimeout(() => setPage('home'), 1500);
                } catch (err) {
                    showToast('Failed to submit post.', 'error');
                    console.error(err);
                }
            };
            
            return (
                 <div className="max-w-4xl mx-auto">
                    <h1 className="text-4xl font-bold mb-8">{initialPost ? "Edit AI-Generated Draft" : "Create New Post"}</h1>
                    <form onSubmit={handleSubmit}>
                        <div className="mb-4">
                            <label htmlFor="title" className="block text-gray-300 mb-2 text-lg">Title</label>
                            <div className="flex items-center space-x-2">
                                <input 
                                    type="text" 
                                    id="title"
                                    value={title}
                                    onChange={e => setTitle(e.target.value)}
                                    className="flex-grow px-3 py-2 bg-gray-800 rounded border border-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                />
                                <button type="button" onClick={handleGenerateTitles} disabled={isGenerating} className="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded flex items-center disabled:opacity-50 transition-colors">
                                    {isGenerating ? <div className="loader"></div> : "Suggest Titles ✨"}
                                </button>
                            </div>
                        </div>
                        {titleSuggestions.length > 0 && (
                            <div className="mb-4 p-4 bg-gray-800 rounded border border-gray-700">
                                <h4 className="font-semibold mb-2">Suggestions:</h4>
                                <div className="flex flex-wrap gap-2">
                                    {titleSuggestions.map((s, i) => (
                                        <button key={i} type="button" onClick={() => setTitle(s)} className="bg-gray-700 hover:bg-emerald-600 text-sm text-white py-1 px-3 rounded-full transition-colors">
                                            {s}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}
                        <div className="mb-4 grid grid-cols-2 gap-4">
                            <div>
                                <label htmlFor="content" className="block text-gray-300 mb-2 text-lg">Content (Markdown)</label>
                                <textarea 
                                    id="content"
                                    rows="15"
                                    value={content}
                                    onChange={e => setContent(e.target.value)}
                                    className="w-full px-3 py-2 bg-gray-800 rounded border border-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500"
                                ></textarea>
                            </div>
                             <div>
                                <label className="block text-gray-300 mb-2 text-lg">Preview</label>
                                <div className="w-full px-3 py-2 bg-gray-800 rounded border border-gray-700 h-[362px] overflow-y-auto prose"
                                    dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(marked.parse(content || '<em>Preview will show here...</em>')) }}
                                />
                            </div>
                        </div>
                        <button type="submit" className="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded transition-colors">
                            Submit for Review
                        </button>
                    </form>
                </div>
            );
        }

        function AdminDashboard({ token }) { /* ... Same as before ... */ 
             const [allBlogs, setAllBlogs] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [summaries, setSummaries] = useState({});
            const [summarizingId, setSummarizingId] = useState(null);

            useEffect(() => {
                const fetchAllBlogs = async () => {
                    try {
                        const response = await axios.get(`${API_URL}/blogs/all`, {
                            headers: { Authorization: `Bearer ${token}` }
                        });
                        setAllBlogs(response.data.data.reverse());
                    } catch (error) {
                        console.error("Failed to fetch blogs for admin", error);
                    } finally {
                        setIsLoading(false);
                    }
                };
                fetchAllBlogs();
            }, [token]);
            
            const handleSummarize = async (blog) => {
                setSummarizingId(blog._id);
                try {
                    const prompt = `Summarize the following blog post in two concise sentences for a busy admin who needs to approve it.\n\nTitle: ${blog.title}\nContent:\n${blog.content}`;
                    const summary = await callGeminiAPI(prompt);
                    setSummaries({...summaries, [blog._id]: summary });
                } catch(err) {
                    console.error("Failed to summarize post", err);
                    setSummaries({...summaries, [blog._id]: "Error: Could not generate summary." });
                } finally {
                    setSummarizingId(null);
                }
            };

            const handleStatusUpdate = async (id, status) => {
                try {
                    const response = await axios.put(`${API_URL}/blogs/${id}`, { status }, {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    setAllBlogs(allBlogs.map(b => b._id === id ? response.data.data : b));
                } catch (error) {
                    console.error("Failed to update blog status", error);
                }
            };
            
            const renderBlogList = (blogs, title) => (
                <div className="bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-700">
                    <h2 className="text-2xl font-bold mb-4">{title}</h2>
                    <ul className="space-y-4">
                        {blogs.length > 0 ? blogs.map(blog => (
                            <li key={blog._id} className="bg-gray-700 p-4 rounded">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <h3 className="text-xl font-semibold text-white">{blog.title}</h3>
                                        <p className="text-sm text-gray-400">by {blog.author.name}</p>
                                    </div>
                                    <div className="space-x-2 flex items-center">
                                        <button onClick={() => handleSummarize(blog)} disabled={summarizingId === blog._id} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-1 px-3 rounded disabled:opacity-50 transition-colors">
                                            {summarizingId === blog._id ? <div className="loader w-4 h-4"></div> : "Summarize ✨"}
                                        </button>
                                         {blog.status !== 'approved' && 
                                            <button onClick={() => handleStatusUpdate(blog._id, 'approved')} className="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 rounded transition-colors">Approve</button>
                                         }
                                         {blog.status !== 'rejected' &&
                                            <button onClick={() => handleStatusUpdate(blog._id, 'rejected')} className="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded transition-colors">Reject</button>
                                         }
                                    </div>
                                </div>
                                {summaries[blog._id] && (
                                    <div className="mt-4 p-3 bg-gray-600 rounded">
                                        <p className="text-sm text-gray-200">{summaries[blog._id]}</p>
                                    </div>
                                )}
                            </li>
                        )) : <p className="text-gray-400">No blogs in this category.</p>}
                    </ul>
                </div>
            );
            
            if (isLoading) return <p>Loading dashboard...</p>;

            const pendingBlogs = allBlogs.filter(b => b.status === 'pending');
            const approvedBlogs = allBlogs.filter(b => b.status === 'approved');
            const rejectedBlogs = allBlogs.filter(b => b.status === 'rejected');

            return (
                <div>
                    <h1 className="text-4xl font-bold mb-8">Admin Dashboard</h1>
                    <div className="space-y-8">
                        {renderBlogList(pendingBlogs, "Pending Blogs")}
                        {renderBlogList(approvedBlogs, "Approved Blogs")}
                        {renderBlogList(rejectedBlogs, "Rejected Blogs")}
                    </div>
                </div>
            )
        }
        
        // --- Render the App ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ToastProvider>
                <App />
            </ToastProvider>
        );

    </script>
</body>
</html>





